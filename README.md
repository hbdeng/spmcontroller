# spmcontroller
Universal Scanning Probe Microscope (SPM) Controller with PyQt, QtCreator, Python. There can be two channels in display.
<p style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: left;"><span style="color: black; font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-position: normal; vertical-align: baseline; white-space: pre-wrap;"><b></b></span></p><div><span id="docs-internal-guid-c34386f3-7fff-673e-e30d-0c1ce01b516e"><br /><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"><span style="border: none; display: inline-block; height: 517px; overflow: hidden; width: 624px;"><img height="517" src="https://lh6.googleusercontent.com/cmH4iJgoTU_9S5uAA6XUwKvvp-1n7bzty7RiA2mCYAFsxza8XYLbU37v7Pw82ENkSvm1-FvhWJIjrBDy2zrlEp9bpEyVKVJai_PT6xP0UidiR74uU4O4VUCCElSbaXfRlLOCTFLQ=s0" style="margin-left: 0px; margin-top: 0px;" width="624" /></span></span></p><br /><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">Motivation</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;For home-build scanning probe systems in labs, SpecsGroup's Nanonis system is often considered a good solution with various working modes for piezo stage control. However, its' price may not be very friendly for some SPM systems, which do not need a sophisticated feedback PID loop. It is overkill especially for the non-feedback laser microwave impedance microscopy system in our lab. We had a LabView program developed by former students, but it lacks the rotational degree of freedom and line scan mode. Also, the UI's inconvenience has always been painful for users. In order to add more flexibility, I rebuilt a new control system for the SPM with QtCreator with Python as the backend.</span></p><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">Functionalities</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;For convenience, all functionalities are embedded on the same page. Multithreading was implemented for scanning, imaging, and data saving. Many of the functionalities are following the workflow of Park AFM system.</span></p><br /><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;Scan: </span><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">By clicking "Scan", the controller will first move the tip to the starting point with the speed calculated from the frequency provided by the user. Then the program will continuously scan the starting line and show the linecuts of trace and retrace in real-time. After clicking it, the button will become a button with text "OFF" and all parameter boxes will be greyed out for safety. By clicking "OFF", the scan will halt immediately.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;Image:</span><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> This is the core functionality of the controller. After hitting the "Image" button, the scanner will start to run line by line with given parameters. The box on the top-left graph window shows the scanning window relative to the whole reachable regions of the piezo as the black background suggests. Tuning the parameters of x, y, and rotation will shift the scan window accordingly for imaging. When the parameters makes the window out of the piezo limit, there will be an error popping out, the box in the graph will turn red, and the scan/image button won't work before the error is resolved by adjusting the scan window. The top-left graph is intended for finding the good scan window, while the bottom two graphs are zoomed-in images from two channels of our signal inputs: channel 1 and channel2, corresponding to MIM imaginary and real parts. Of course one can use the two channels for other purposes other than MIM measurement.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt; text-align: center;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"><span style="border: none; display: inline-block; height: 517px; overflow: hidden; width: 624px;"><img height="517" src="https://lh3.googleusercontent.com/czfdBZTttYMsXvT97PCb6EeDJWSaHIkxhLTerQ35j5H5l0ot3LrTPd2_J0IL73wJEr7p2mmkKJZ5XtfRx3AbXJzYW9LXsXhRqOAlD3-jaK0VweA2w4upbC4fX9KbkxoAlybhzZx0=s0" style="margin-left: 0px; margin-top: 0px;" width="624" /></span></span></p><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;Signal I/O:</span><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> The official NI DAQ API was used in data input and output and the data will be displayed in real-time in the line scan graphs. Since users may use large frequencies, the real-time display may lag due to the high refreshing rate. Here I implemented batch processing with a 100ms time interval to avoid possible freezing. Also, since the DAQ API signal reading takes a significant amount of time and the time may vary for each pixel, I make the waiting time for each data point dynamic and it can be adjusted automatically to make the whole scan smoothly.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;File saving:</span><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> The files will be saved in the given directory with the given filename. Users can use {d} and {t} to replace the current date and time in filename. File saving usually takes some time. Since we want to save data every time a line is finished, a different thread was implemented for file saving to avoid the imaging module from freezing. Files will be saved in two formats. "*.txt" file contains the raw data, and ".tiff" file has XEI-readable data format.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Image parameters: Users can freely choose Channel 1/2 and Trace/Retrace. The UI will update the corresponding graphs instantly.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; font-weight: 700; vertical-align: baseline; white-space: pre-wrap;">&nbsp;&nbsp;&nbsp;&nbsp;Z-control and maintenance mode:</span><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"> Z-controller is also included for quick MIM tip approaching or reapproaching. The maintenance mode is optional for users to deal with emergent situations such as loss of status due to a computer or program crash.</span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"><br /></span></p><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;"><span>&nbsp;&nbsp; &nbsp;The hardware module is separated from the SPM controller main module. Users can easily create their own hardware I/O module with their own devices while using the same interface. </span><br /></span></p><br /><br /><p dir="ltr" style="line-height: 1.38; margin-bottom: 0pt; margin-top: 0pt;"><span style="font-family: Arial; font-size: 11pt; font-variant-east-asian: normal; font-variant-numeric: normal; vertical-align: baseline; white-space: pre-wrap;">Project Link: <a href="https://github.com/xuejianma/spmcontroller">https://github.com/xuejianma/spmcontroller</a></span></p><br /></span><div class="separator" style="clear: both; text-align: center;"><p></p></div></div>
